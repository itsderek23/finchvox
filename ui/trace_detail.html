<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trace Detail - Finchvox</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'span-stt': '#f97316',
                        'span-llm': '#ec4899',
                        'span-tts': '#a855f7',
                        'span-turn': '#10b981',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="/css/app.css">
    <script defer src="/lib/alpine.min.js"></script>
    <script src="/lib/wavesurfer.min.js"></script>
</head>
<body class="bg-[#050507] text-white min-h-screen flex flex-col overflow-y-auto overflow-x-hidden text-sm font-sans" x-data="traceDetailApp()" x-init="init()">

    <!-- Main flex container for content and side panel -->
    <div class="flex flex-1 overflow-y-hidden overflow-x-visible relative">
        <!-- Main content area -->
        <div class="flex-1 flex flex-col overflow-y-auto overflow-x-visible transition-[margin-right] duration-300 ease-out" :class="{ 'mr-[400px]': isPanelOpen || isLogPanelOpen }">
            <!-- Fixed container for header and audio player -->
            <div class="fixed top-0 left-0 z-[100] bg-[#050507]" :class="{ 'right-[400px]': isPanelOpen || isLogPanelOpen, 'right-0': !isPanelOpen && !isLogPanelOpen }">
                <!-- Back button -->
                <div class="py-3.5 px-8 border-b border-white/10 flex items-center gap-2.5 bg-[#050507]">
                    <img src="/images/finchvox-logo.png" alt="FinchVox Logo" class="h-5 w-auto"> <a href="/" class="text-amber-400 underline hover:text-amber-300 transition-colors">Traces</a> / <span x-show="serviceName" x-text="serviceName"></span> <span x-show="serviceName">/ </span><span x-text="traceId">loading...</span>
                    <span x-show="isPolling" class="live-badge">Live</span>
                </div>

                <!-- Waiting for Audio (Live Trace) -->
                <div x-show="audioError && isPolling" x-cloak class="flex items-center gap-3 p-4 px-5 mt-24 mx-8 mb-4 bg-white/[0.02] border border-white/10 rounded-sm text-orange-400">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 shrink-0">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
                    </svg>
                    <span>
                        Waiting for audio data... (trace is live)
                    </span>
                </div>

                <!-- Audio Error Message (Completed Trace) -->
                <div x-show="audioError && !isPolling" x-cloak class="flex items-center gap-3 p-4 px-5 mt-24 mx-8 mb-4 bg-white/[0.02] border border-white/10 rounded-sm text-orange-400">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 shrink-0">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
                    </svg>
                    <span>
                        No audio data available. See the <a href="https://github.com/itsderek23/finchvox/README.md#troubleshooting" target="_blank" class="text-orange-400 underline hover:text-orange-300 transition-colors">troubleshooting guide</a>.
                    </span>
                </div>

                <!-- Audio Player Section -->
                <section class="py-4 px-8 border-b border-white/10 bg-white/[0.02]" x-show="!audioError">
                <div class="flex items-center justify-between gap-4 mb-4">
                    <div class="flex items-center gap-4">
                        <button @click="togglePlay()" class="h-6 flex items-center bg-transparent hover:bg-zinc-800 text-zinc-300 hover:text-zinc-100 border border-zinc-600 rounded px-2.5 py-0.5 text-xs transition-colors focus:outline-none" title="SPACEBAR">
                            <span x-show="!playing" class="flex items-center justify-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z" />
                                  </svg> <span>Play</span>
                            </span>
                            <span x-show="playing" class="flex items-center justify-center gap-2">
                                <span>⏸</span><span>Pause</span>
                            </span>
                        </button>
                        <span class="text-[11px] leading-6 h-6 align-middle">
                            <span class="font-mono text-white/70" x-text="formatTime(currentTime)">00:00</span>
                            <span class="text-white/40">/</span>
                            <span class="font-mono text-white/70" x-text="formatTime(duration)">00:00</span>
                        </span>
                    </div>
                    <div class="flex items-center gap-2">
                        <a :href="'/api/trace/' + traceId + '/raw'" target="_blank" class="h-6 flex items-center bg-transparent hover:bg-zinc-800 text-zinc-300 hover:text-zinc-100 border border-zinc-600 rounded px-2.5 py-0.5 text-xs transition-colors no-underline" title="View raw trace data">
                            <span class="flex items-center justify-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3-4.5 16.5" />
                                </svg>
                                <span>Raw</span>
                            </span>
                        </a>
                        <a :href="'/api/audio/' + traceId + '/download'" download class="h-6 flex items-center gap-2 bg-transparent hover:bg-zinc-800 text-zinc-300 hover:text-zinc-100 border border-zinc-600 rounded px-2.5 py-0.5 text-xs transition-colors no-underline" title="Download Audio">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
                            </svg>
                        </a>
                    </div>
                </div>


                <!-- Hover Marker Overlay -->
                <div class="absolute top-[102px] left-0 h-[157px] pointer-events-none z-20" x-show="hoverMarker.visible" :style="`left: ${getMarkerPosition()}`">
                    <div class="absolute top-0 left-1/2 -translate-x-1/2 bg-gray-500 text-black py-0.5 px-1.5 rounded-sm text-[10px] font-medium tracking-wide font-mono whitespace-nowrap z-20" x-text="getMarkerTimeLabel()"></div>
                    <div class="absolute top-4 h-[117px] left-0 w-px bg-gray-500"></div>
                </div>

                <!-- Timeline -->
                <div class="flex gap-5">
                    <div class="w-20 shrink-0"></div>
                    <div id="timeline" class="flex-1 h-6 mb-1 border-b border-white/10 pb-0.5"></div>
                </div>

                <!-- Human text chunks -->
                <div class="flex gap-5 h-[22px] mb-1"
                    x-show="getTurnChunks().length > 0">
                    <div class="w-20 shrink-0"></div>
                    <div class="flex-1 relative pointer-events-none">
                        <template x-for="chunk in getTurnChunks()" :key="chunk.span_id_hex">
                            <div class="absolute h-5 px-1.5 flex items-center bg-white/5 rounded-sm overflow-hidden whitespace-nowrap pointer-events-auto cursor-pointer transition-colors border border-black text-ellipsis text-white/70 hover:bg-[#3a3a3a]"
                                x-show="chunk.humanText"
                                :class="{ 'bg-[#3a3a3a]': hoveredSpan?.span_id_hex === chunk.span_id_hex }"
                                :style="`left: ${chunk.style.left}; max-width: ${chunk.style.width}`"
                                @mouseenter="highlightSpanFromChunk(chunk.span)"
                                @mouseleave="unhighlightSpanFromChunk()"
                                @click="handleChunkClick(chunk.span)">
                                <span class="text-[10px] leading-[10px]" x-text="chunk.humanText"></span>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Waveform with channel labels -->
                <div class="flex gap-5 mb-1">
                    <div class="w-20 shrink-0 flex flex-col justify-around text-[11px] font-mono">
                        <span class="text-[#f97316] flex items-center justify-end gap-1.5">
                            User
                            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z" />
                            </svg>
                        </span>
                        <span class="text-[#a855f7] flex items-center justify-end gap-1.5">
                            Agent
                            <svg class="w-4 h-4" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M8.48 4h4l.5.5v2.03h.52l.5.5V8l-.5.5h-.52v3l-.5.5H9.36l-2.5 2.76L6 14.4V12H3.5l-.5-.64V8.5h-.5L2 8v-.97l.5-.5H3V4.36L3.53 4h4V2.86A1 1 0 0 1 7 2a1 1 0 0 1 2 0 1 1 0 0 1-.52.83V4zM12 8V5H4v5.86l2.5.14H7v2.19l1.8-2.04.35-.15H12V8zm-2.12.51a2.71 2.71 0 0 1-1.37.74v-.01a2.71 2.71 0 0 1-2.42-.74l-.7.71c.34.34.745.608 1.19.79.45.188.932.286 1.42.29a3.7 3.7 0 0 0 2.58-1.07l-.7-.71zM6.49 6.5h-1v1h1v-1zm3 0h1v1h-1v-1z"/>
                            </svg>
                        </span>
                    </div>
                    <div id="waveform" class="flex-1 rounded overflow-hidden border-b border-white/10 h-[81px]"></div>
                </div>

                <!-- Bot text chunks -->
                <div class="flex gap-5 h-[22px] mb-0"
                    x-show="getTurnChunks().length > 0">
                    <div class="w-20 shrink-0"></div>
                    <div class="flex-1 relative pointer-events-none">
                        <template x-for="chunk in getTurnChunks()" :key="chunk.span_id_hex">
                            <div class="absolute h-5 px-1.5 flex items-center bg-white/5 rounded-sm overflow-hidden whitespace-nowrap pointer-events-auto cursor-pointer transition-colors border border-black text-ellipsis text-white/70 hover:bg-[#3a3a3a]"
                                x-show="chunk.botText"
                                :class="{ 'bg-[#3a3a3a]': hoveredSpan?.span_id_hex === chunk.span_id_hex }"
                                :style="`left: ${chunk.style.left}; max-width: ${chunk.style.width}`"
                                @mouseenter="highlightSpanFromChunk(chunk.span)"
                                @mouseleave="unhighlightSpanFromChunk()"
                                @click="handleChunkClick(chunk.span)">
                                <span class="text-[10px] leading-[10px]" x-html="formatBotChunkText(chunk)"></span>
                            </div>
                        </template>
                    </div>
                </div>
            </section>

                <!-- View Tabs -->
                <div class="flex gap-6 px-8 py-3 bg-[#050507]">
                    <button @click="switchView('trace')"
                            class="pb-1 text-sm font-medium transition-colors border-b-2"
                            :class="selectedView === 'trace' ? 'border-amber-500 text-white' : 'border-transparent text-white/50 hover:text-white/70'">
                        Trace
                    </button>
                    <button @click="switchView('logs')"
                            class="pb-1 text-sm font-medium transition-colors border-b-2"
                            :class="selectedView === 'logs' ? 'border-amber-500 text-white' : 'border-transparent text-white/50 hover:text-white/70'">
                        Logs
                    </button>
                </div>
            </div><!-- End fixed-container -->

    <!-- Trace View -->
    <main x-show="selectedView === 'trace'" class="flex-1 mt-[328px]">
        <div class="overflow-y-hidden overflow-x-visible flex flex-col h-[calc(100vh-368px)]">

            <!-- Swimlane Body (Scrollable) -->
            <div class="flex-1 overflow-y-auto overflow-x-visible px-8 space-y-[10px]">
                <template x-for="spanType in getSpanTypes()" :key="spanType">
                    <div class="h-6 flex items-center gap-5">
                        <!-- Type Label -->
                        <div class="w-20 shrink-0 text-[11px] text-white/50 font-mono text-right" x-text="spanType"></div>

                        <!-- Timeline Track -->
                        <div class="flex-1 relative h-5">
                            <template x-for="span in getSpansByType(spanType)" :key="span.span_id_hex">
                                <div class="timeline-bar cursor-pointer"
                                     :class="`bar-${span.name} ${(highlightedSpan?.span_id_hex === span.span_id_hex || selectedSpan?.span_id_hex === span.span_id_hex || chunkHoveredSpan?.span_id_hex === span.span_id_hex) ? 'selected' : ''}`"
                                     :style="`left: ${getTimelineBarStyle(span).left}; width: ${getTimelineBarStyle(span).width}; opacity: ${selectedSpan && selectedSpan.span_id_hex !== span.span_id_hex ? 0.5 : 1}`"
                                     :data-span-id="span.span_id_hex"
                                     @click="selectSpan(span, true)"
                                     @mouseenter="highlightSpan(span)"
                                     @mouseleave="unhighlightSpan()">
                                    <span x-show="!hasOverlappingLabels(spanType)" class="text-white/85 text-[10px] font-mono whitespace-nowrap px-1.5" x-html="formatBarDuration(span)"></span>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>

        </div>
    </main>

    <!-- Logs View -->
    <main x-show="selectedView === 'logs'" class="flex-1 mt-[328px]">
        <div class="overflow-y-hidden overflow-x-visible flex flex-col h-[calc(100vh-368px)]">
            <!-- Filter Bar -->
            <div class="flex items-center justify-between px-8 py-2 border-b border-white/10 shrink-0">
                <div class="relative">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 absolute left-2 top-1/2 -translate-y-1/2 text-white/40">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                    </svg>
                    <input type="text"
                           x-model="logSearchQuery"
                           placeholder="Filter logs..."
                           class="bg-white/[0.02] border border-white/10 rounded-sm pl-8 pr-3 py-1 text-xs text-white placeholder-white/40 focus:outline-none focus:border-white/20 w-64">
                </div>
                <div class="flex gap-1">
                    <template x-for="level in ['DEBUG', 'INFO', 'WARN', 'ERROR']" :key="level">
                        <button @click="toggleLogLevel(level)"
                                class="px-2.5 py-0.5 text-xs rounded border transition-colors"
                                :class="logLevelFilters[level]
                                    ? 'bg-zinc-600 border-zinc-600 text-white'
                                    : 'bg-transparent border-zinc-700 text-zinc-500'"
                                x-text="level"></button>
                    </template>
                </div>
            </div>

            <!-- Loading state -->
            <div x-show="logsLoading" class="flex-1 flex items-center justify-center">
                <span class="text-white/40">Loading logs...</span>
            </div>

            <!-- Empty state -->
            <div x-show="!logsLoading && logs.length === 0" class="flex-1 flex items-center justify-center">
                <span class="text-white/40">No logs for this trace</span>
            </div>

            <!-- No matches state -->
            <div x-show="!logsLoading && logs.length > 0 && getFilteredLogs().length === 0" class="flex-1 flex items-center justify-center">
                <span class="text-white/40">No logs match the current filters</span>
            </div>

            <!-- Logs table -->
            <div class="flex-1 overflow-y-auto overflow-x-hidden" x-show="!logsLoading && getFilteredLogs().length > 0">
                <table class="w-full table-fixed">
                    <thead class="sticky top-0 bg-[#050507] z-10">
                        <tr class="border-b border-white/10 text-white/40 text-xs font-semibold">
                            <th class="w-28 px-8 py-2 text-left font-semibold">Time</th>
                            <th class="w-20 px-4 py-2 text-left font-semibold">Level</th>
                            <th class="w-48 px-4 py-2 text-left font-semibold">Logger</th>
                            <th class="px-4 py-2 text-left font-semibold">Message</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="(log, index) in getFilteredLogs()" :key="index">
                            <tr class="h-8 cursor-pointer border-l-2 border-transparent transition-colors"
                                :class="{
                                    'bg-[#0f0f0f]': index % 2 === 1 && selectedLog !== log && highlightedLogIndex !== index && !['WARN', 'WARNING', 'ERROR', 'FATAL', 'CRITICAL'].includes(log.severity_text?.toUpperCase()),
                                    'bg-amber-500/10': ['WARN', 'WARNING'].includes(log.severity_text?.toUpperCase()) && selectedLog !== log,
                                    'bg-red-500/10': ['ERROR', 'FATAL', 'CRITICAL'].includes(log.severity_text?.toUpperCase()) && selectedLog !== log,
                                    'hover:bg-amber-500/[0.08]': selectedLog !== log,
                                    'bg-amber-500/[0.15] border-l-amber-500': selectedLog === log || highlightedLogIndex === index
                                }"
                                :data-log-index="index"
                                @click="selectLog(log, index)"
                                @mouseenter="highlightLog(log)"
                                @mouseleave="unhighlightLog()">
                                <td class="px-8 py-2 text-white/60 text-xs truncate font-mono" x-text="formatLogRelativeTime(log.time_unix_nano)"></td>
                                <td class="px-4 py-2 text-xs whitespace-nowrap font-mono" :class="getLogLevelClass(log.severity_text)" x-text="log.severity_text"></td>
                                <td class="px-4 py-2 text-white/70 text-xs truncate font-mono" x-text="log.instrumentation_scope?.name || ''"></td>
                                <td class="px-4 py-2 text-white text-xs truncate font-mono" x-text="getLogBody(log)"></td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>

            <!-- Log count info -->
            <div x-show="!logsLoading && logs.length > 0" class="px-8 py-2 border-t border-white/10 text-white/40 text-xs">
                Showing <span x-text="getFilteredLogs().length"></span> of <span x-text="logs.length"></span> logs
                <span x-show="logsTotalCount > logsLimit"> (limited to <span x-text="logsLimit"></span>)</span>
            </div>
        </div>
    </main>

        </div><!-- End main-content -->

        <!-- Side Panel (span details) -->
        <aside class="fixed top-12 right-0 bottom-0 w-[400px] bg-[#050507] border-l border-t border-white/10 overflow-y-auto z-[100] shadow-[-4px_0_20px_rgba(0,0,0,0.5)]"
           x-show="isPanelOpen"
           x-transition:enter="transition ease-out duration-300"
           x-transition:enter-start="translate-x-full"
           x-transition:enter-end="translate-x-0"
           x-transition:leave="transition ease-in duration-200"
           x-transition:leave-start="translate-x-0"
           x-transition:leave-end="translate-x-full">
            <div class="flex justify-between items-center py-2 px-8 border-b border-white/10 sticky top-0 z-10 bg-[#050507]">
                <h3 class="text-sm font-semibold tracking-wide" x-text="selectedSpan?.name">Span Details</h3>
                <button @click="closePanel()" class="bg-transparent border-none text-white/70 text-sm cursor-pointer w-10 h-10 flex items-center justify-center rounded transition-all hover:bg-white/[0.02] hover:text-white" title="ESC">✕</button>
            </div>
            <div class="p-8">
                <div class="grid gap-4 mb-8">
                    <div class="grid grid-cols-[150px_1fr] gap-4">
                        <label class="text-white/40 font-semibold text-xs">Duration:</label>
                        <span class="text-white text-xs" x-text="formatSpanDuration(selectedSpan)"></span>
                    </div>
                    <div class="grid grid-cols-[150px_1fr] gap-4" x-show="getTTFB(selectedSpan) !== null">
                        <label class="text-white/40 font-semibold text-xs" title="Time to First Byte">TTFB</label>
                        <span class="text-white text-xs" x-text="formatTTFB(selectedSpan)"></span>
                    </div>
                    <div class="grid grid-cols-[150px_1fr] gap-4" x-show="getUserBotLatency(selectedSpan) !== null">
                        <label class="text-white/40 font-semibold text-xs">User ↔ Bot Latency</label>
                        <span class="text-white text-xs" x-html="formatUserBotLatency(selectedSpan)"></span>
                    </div>
                    <div class="grid grid-cols-[150px_1fr] gap-4">
                        <label class="text-white/40 font-semibold text-xs">Relative start time</label>
                        <span class="text-white text-xs" x-text="formatRelativeStartTime(selectedSpan)"></span>
                    </div>
                    <div class="grid grid-cols-[150px_1fr] gap-4">
                        <label class="text-white/40 font-semibold text-xs">Start time</label>
                        <span class="text-white text-xs" x-text="formatTimestamp(selectedSpan?.start_time_unix_nano)"></span>
                    </div>
                    <div class="grid grid-cols-[150px_1fr] gap-4">
                        <label class="text-white/40 font-semibold text-xs">End time</label>
                        <span class="text-white text-xs" x-text="formatTimestamp(selectedSpan?.end_time_unix_nano)"></span>
                    </div>
                    <div class="grid grid-cols-[150px_1fr] gap-4" x-show="wasInterrupted(selectedSpan) !== null">
                        <label class="text-white/40 font-semibold text-xs">Interrupted?</label>
                        <span class="text-white text-xs" x-html="formatInterrupted(selectedSpan)"></span>
                    </div>
                </div>

                <!-- Dedicated attribute displays for specific span types -->

                <!-- LLM Input -->
                <div x-show="selectedSpan?.name === 'llm' && hasAttribute(selectedSpan, 'input')">
                    <label class="text-white/40 font-semibold text-xs mb-2 flex justify-between items-center">Input</label>
                    <pre class="bg-[#050507] p-2 overflow-x-auto font-mono text-[13px] leading-relaxed text-emerald-500 border border-white/10 mb-4 max-h-[300px] overflow-y-auto whitespace-pre-wrap break-words" x-text="formatAttributeValue(selectedSpan, 'input')"></pre>
                </div>

                <!-- Tool Calls -->
                <div x-show="selectedSpan?.name === 'llm' && getToolCalls(selectedSpan).length > 0">
                    <label class="text-white/40 font-semibold text-xs mb-2 flex justify-between items-center">Tool Calls</label>
                    <pre class="bg-[#050507] p-2 overflow-x-auto font-mono text-[13px] leading-relaxed text-emerald-500 border border-white/10 mb-4 max-h-[300px] overflow-y-auto whitespace-pre-wrap break-words" x-text="formatToolCalls(selectedSpan)"></pre>
                </div>

                <!-- LLM Output -->
                <div x-show="selectedSpan?.name === 'llm' && hasAttribute(selectedSpan, 'output')">
                    <label class="text-white/40 font-semibold text-xs mb-2 flex justify-between items-center">Output</label>
                    <pre class="bg-[#050507] p-2 overflow-x-auto font-mono text-[13px] leading-relaxed text-emerald-500 border border-white/10 mb-4 max-h-[300px] overflow-y-auto whitespace-pre-wrap break-words" x-text="formatAttributeValue(selectedSpan, 'output')"></pre>
                </div>

                <!-- TTS Text -->
                <div x-show="selectedSpan?.name === 'tts' && hasAttribute(selectedSpan, 'text')">
                    <label class="text-white/40 font-semibold text-xs mb-2 flex justify-between items-center">Text</label>
                    <pre class="bg-[#050507] p-2 overflow-x-auto font-mono text-[13px] leading-relaxed text-emerald-500 border border-white/10 mb-4 max-h-[300px] overflow-y-auto whitespace-pre-wrap break-words" x-text="formatAttributeValue(selectedSpan, 'text')"></pre>
                </div>

                <!-- STT Transcript -->
                <div x-show="selectedSpan?.name === 'stt' && hasAttribute(selectedSpan, 'transcript')">
                    <label class="text-white/40 font-semibold text-xs mb-2 flex justify-between items-center">Transcript</label>
                    <pre class="bg-[#050507] p-2 overflow-x-auto font-mono text-[13px] leading-relaxed text-emerald-500 border border-white/10 mb-4 max-h-[300px] overflow-y-auto whitespace-pre-wrap break-words" x-text="formatAttributeValue(selectedSpan, 'transcript')"></pre>
                </div>

                <!-- Raw Span JSON -->
                <div>
                    <label class="text-white/40 font-semibold text-xs mb-2 flex justify-between items-center">
                        Raw
                        <button class="h-6 flex items-center bg-transparent hover:bg-zinc-800 text-zinc-300 hover:text-zinc-100 border border-zinc-600 rounded px-2.5 py-0.5 text-xs transition-colors focus:outline-none ml-4"
                              :class="{ 'text-emerald-500': spanCopied }"
                              @click="copySpanToClipboard()"
                              title="Copy to Clipboard">
                              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75" />
                              </svg>
                        </button>
                    </label>
                    <pre class="bg-[#050507] p-2 overflow-x-auto font-mono text-[13px] leading-relaxed text-emerald-500 border border-white/10 mb-4 max-h-[300px] overflow-y-auto whitespace-pre-wrap break-words" x-text="getRawSpanJSON(selectedSpan)"></pre>
                </div>
            </div>
        </aside>

        <!-- Side Panel (log details) -->
        <aside class="fixed top-12 right-0 bottom-0 w-[400px] bg-[#050507] border-l border-t border-white/10 overflow-y-auto overflow-x-hidden z-[100] shadow-[-4px_0_20px_rgba(0,0,0,0.5)]"
           x-show="isLogPanelOpen"
           x-transition:enter="transition ease-out duration-300"
           x-transition:enter-start="translate-x-full"
           x-transition:enter-end="translate-x-0"
           x-transition:leave="transition ease-in duration-200"
           x-transition:leave-start="translate-x-0"
           x-transition:leave-end="translate-x-full">
            <div class="flex justify-between items-center py-2 px-8 border-b border-white/10 sticky top-0 z-10 bg-[#050507]">
                <h3 class="text-sm font-semibold tracking-wide">Inspect log</h3>
                <button @click="closeLogPanel()" class="bg-transparent border-none text-white/70 text-sm cursor-pointer w-10 h-10 flex items-center justify-center rounded transition-all hover:bg-white/[0.02] hover:text-white" title="ESC">✕</button>
            </div>
            <div class="p-8" x-show="selectedLog">
                <div class="grid gap-4 mb-8">
                    <div class="grid grid-cols-[150px_1fr] gap-4 min-w-0">
                        <label class="text-white/40 font-semibold text-xs">Severity:</label>
                        <span class="text-xs truncate" :class="getLogLevelClass(selectedLog?.severity_text)" x-text="selectedLog?.severity_text"></span>
                    </div>
                    <div class="grid grid-cols-[150px_1fr] gap-4 min-w-0">
                        <label class="text-white/40 font-semibold text-xs">Relative start time:</label>
                        <span class="text-white text-xs truncate" x-text="formatLogRelativeTime(selectedLog?.time_unix_nano)"></span>
                    </div>
                    <div class="grid grid-cols-[150px_1fr] gap-4 min-w-0">
                        <label class="text-white/40 font-semibold text-xs">Timestamp:</label>
                        <span class="text-white text-xs truncate" x-text="formatLogTimestamp(selectedLog?.time_unix_nano)"></span>
                    </div>
                    <div class="grid grid-cols-[150px_1fr] gap-4 min-w-0">
                        <label class="text-white/40 font-semibold text-xs">Logger:</label>
                        <span class="text-white text-xs truncate" x-text="selectedLog?.instrumentation_scope?.name || 'N/A'"></span>
                    </div>
                </div>

                <!-- Message -->
                <div class="mb-6">
                    <label class="text-white/40 font-semibold text-xs mb-2 block">Message</label>
                    <div class="text-white text-sm bg-[#0a0a0c] p-3 rounded border border-white/10 whitespace-pre-wrap break-words font-mono" x-text="getLogBody(selectedLog)"></div>
                </div>

                <!-- Raw JSON -->
                <div>
                    <label class="text-white/40 font-semibold text-xs mb-2 flex justify-between items-center">
                        Raw
                        <button class="h-6 flex items-center bg-transparent hover:bg-zinc-800 text-zinc-300 hover:text-zinc-100 border border-zinc-600 rounded px-2.5 py-0.5 text-xs transition-colors focus:outline-none ml-4"
                              :class="{ 'text-emerald-500': logCopied }"
                              @click="copyLogToClipboard()"
                              title="Copy to Clipboard">
                              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75" />
                              </svg>
                        </button>
                    </label>
                    <pre class="bg-[#050507] p-2 overflow-x-auto font-mono text-[13px] leading-relaxed text-emerald-500 border border-white/10 mb-4 max-h-[300px] overflow-y-auto whitespace-pre-wrap break-words" x-text="getRawLogJSON(selectedLog)"></pre>
                </div>
            </div>
        </aside>

    </div><!-- End page-layout -->

    <script src="/js/time-utils.js"></script>
    <script src="/js/logs_view.js"></script>
    <script src="/js/trace_detail.js"></script>
</body>
</html>
